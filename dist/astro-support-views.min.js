// Astro single page app - views v0.2.0
// Copyright 2016 Ting Yang and Hector Jarquin
// Released under the MIT license
// Last updated: February 7th, 2016
// 
// Requirement: IE11+
// 
// Summary:
// Turn a data-api-endpoint node to a single page application
// once the item is clicked, it will render a single view 
//
!function(t,e){function n(t){var e;t.apiElements.forEach(function(t,n){for(var r=0;r<t.jsoncontent.length;r++)for(var a=0;a<t.jsoncontent[r].length;a++)e=t.jsoncontent[r][a].URL||t.jsoncontent[r][a].link,u[e]=t.jsoncontent[r][a]})}function r(t){for(var n=[],r=t.querySelectorAll(ASTRO_QUERY_DATASET.view),a=[],o=[],i=0;i<r.length;i++)if(r[i].dataset[e.ASTRO_DATASET_ATTRIBUTE.endpoint])a.push(r[i]);else{o.push(r[i]);var s={name:r[i].dataset[e.ASTRO_DATASET_ATTRIBUTE.appView],viewElement:r[i],list:[]};n.push(s)}for(var l=0;l<a.length;l++)n.forEach(function(t){t.name===a[l].dataset[e.ASTRO_DATASET_ATTRIBUTE.appView]&&t.list.push(a[l])});return n}function a(t){for(var n=0;n<t.length;n++)for(var r=0;r<t[n].list.length;r++)for(var a=t[n].list[r],o=a.querySelectorAll("[data-app-anchor]"),i=0;i<o.length;i++)o[i].setAttribute("href","#"+a.dataset[e.ASTRO_DATASET_ATTRIBUTE.appView]+"#"+o[i].getAttribute("href"))}function o(e){var n=e.lastIndexOf("#"),r=e.substring(1,n),a=t.querySelectorAll("[data-app-view="+r+"]");if(a.length>0){var o=a[a.length-1];return f.currentView=o,o}}function i(n){var r=t.querySelector(ASTRO_QUERY_DATASET.container);if(e.location.hash.length<1)null!==f.currentView&&(f.currentView.style.display="none"),l(r);else{var a=o(e.location.hash);s(a,r,n)}}function s(n,r,a){n.style.display="block",r.style.display="none",e.scrollBy(100,-e.pageYOffset);var o=e.location.hash,i=o.lastIndexOf("#"),s=o.substring(1,i);o=o.substring(i+1),a.forEach(function(t){if(t.name==s){var e=t.viewElement.querySelectorAll(ASTRO_QUERY_DATASET.property),n=u[o];A(n,e)}}),t.dispatchEvent(T)}function l(e){e.style.display="block",t.dispatchEvent(c)}function A(t,e){var n,r;for(n=0;n<e.length;n+=1)r=AstroAPI.Util.ExtractJsonValueByKey(e[n].dataset[ASTRO_DATASET_ATTRIBUTE.properties],t),"IMG"===e[n].tagName?e[n].setAttribute("src",r):"A"===e[n].tagName?e[n].setAttribute("href",r):e[n].innerHTML=r}var T=new CustomEvent("Astro-OnSingleView"),c=new CustomEvent("Astro-OnRepeatView");e.ASTRO_QUERY_DATASET.view="[data-app-view]",e.ASTRO_QUERY_DATASET.container="[data-app-landing]",e.ASTRO_DATASET_ATTRIBUTE.appView="appView";var u={},f={currentView:null};t.addEventListener("AstroAPI-render",function(o){if(!e.AstroAPI)return void console.error("astro-wp-element.js is not found");n(AstroAPI);var s=r(t);a(s),i(s),e.addEventListener("hashchange",function(){i(s)})})}(document,window);