// Astro Framework - WordPress v0.3.1
// Copyright 2016 Ting Yang and Hector Jarquin
// Released under the MIT license
// Last updated: Feburary 15th, 2016 
//
// Support:
//  WordPress.com, the official RESTful api endpoint
//  WordPress.org (self hosted) with Jetpack json-api plugin and WP API
//  
//  
!function(e,t){"use strict";function n(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var r=e.createEvent("CustomEvent");return r.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),r}n.prototype=t.CustomEvent.prototype,t.CustomEvent=n}(document,window),function(e,t){"use strict";function n(){var t;return t=e.querySelectorAll(m.host),t||[]}function r(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push({url:e[t].dataset[f.host],domElements:e[t].querySelectorAll(m.endpoint),jsoncontent:[]});return n}function o(e,t){function n(){var e;return e=u.search(/public-api.wordpress.com/)?"jetpack":"wpapi"}function r(){return c[f.template]?-1!==c[f.template].search(v)?c[f.template]:void 0:"single"}function o(){var e=c[f.parameters]||null;return e}function a(){var e=c[f.endpoint]||null;return e}function i(){var e="",t=o();return"/"!==u.slice(-1)&&(u+="/"),e+=u+a(),null!==t&&(e+="?"+t),e}function l(){return t.querySelector("*")}function s(){return t}function p(){return t.querySelectorAll(m.property)}var u=e,c=t.dataset;return{url:i,template:r,endPoint:a,childnodes:l,elementNode:s,properties:p,elementType:n}}function a(e){for(var t=0,n=0;n<e.apiElements.length;n++)t+=e.apiElements[n].domElements.length;return t}function i(){var e=n(),t=r(e);h.apiElements=t}function l(t){var n,r,i=0,l=a(h);h.apiElements.forEach(function(a){for(n=0;n<a.domElements.length;n+=1)r=o(a.url,a.domElements[n]),function(n,r){y.GetContentFromWordpress(n.url(),function(o,a){o&&t(n,a),Array.isArray(a)?r.jsoncontent.push(a):a.posts?r.jsoncontent.push(a.posts):r.jsoncontent.push([a]),t(n,a),i+=1,i===l&&e.dispatchEvent(d)})}(r,a)})}function s(e,t){var n;if("repeat"===e.template()){var r,o,a=e.childnodes(),n=t[e.endPoint()]||t;for(r=1;r<n.length;r+=1)o=a.cloneNode(!0),e.elementNode().appendChild(o)}else n=t;p(e,n)}function p(e,t){var n,r;n=e.elementNode(),r=n.querySelectorAll(m.property),"single"===e.template()?"jetpack"===e.elementType()&&(t.posts&&(t=t[e.endPoint()][0]),c(t,r)):"repeat"===e.template()&&u(e,t)}function u(e,t){var n,r,o;for(r=0;r<t.length;r+=1)n=e.elementNode().children[r],o=n.querySelectorAll(m.property),c(t[r],o)}function c(e,t){var n,r;for(n=0;n<t.length;n+=1)r=y.ExtractJsonValueByKey(t[n].dataset[f.properties],e),"IMG"===t[n].tagName?t[n].setAttribute("src",r):"A"===t[n].tagName?t[n].setAttribute("href",r):t[n].innerHTML=r}var d=new CustomEvent("AstroAPI-render"),m={host:"[data-api-host]",endpoint:"[data-api-endpoint]",property:"[data-api-property]"},f={host:"apiHost",endpoint:"apiEndpoint",parameters:"apiParameters",template:"apiTemplate",properties:"apiProperty",singlePage:"partialView"},v=/repeat|single/,h={},y={GetContentFromWordpress:function(e,n){var r;r=t.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.onreadystatechange=function(){4===r.readyState&&200===r.status&&n(null,JSON.parse(r.responseText))},r.open("GET",e,!0),r.send()},ExtractJsonValueByKey:function(e,t){for(var n=e,r=n.split("."),o=0;o<r.length;o+=1)t=t[r[o]];return t}};i(),l(function(e,t){s(e,t)}),h.Util=y,t.AstroAPI=h,t.ASTRO_QUERY_DATASET=m,t.ASTRO_DATASET_ATTRIBUTE=f}(document,window);